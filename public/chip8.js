"use strict";var _createClass=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},Chip8=function(){function a(){_classCallCheck(this,a),this.reset()}return _createClass(a,{loadGame:{value:function(a){for(var b=0;b<a.byteLength;b++)this.memory[b+512]=a[b]}},reset:{value:function(){var a,b=[240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128];for(this.opcode=0,this.memory=new Array(4096),a=0;a<this.memory.length;a++)this.memory[a]=0;for(a=0;a<b.length;a++)this.memory[a]=b[a];for(this.V=new Array(16),a=0;a<this.V.length;a++)this.V[a]=0;for(this.I=0,this.PC=512,this.screen=new Array(2048),this.clearDisplay(),this.delayTimer=0,this.soundTimer=0,this.stack=new Array(16),a=0;a<this.stack.length;a++)this.stack[a]=0;for(this.SP=0,this.key=new Array(16),a=0;a<this.key.length;a++)this.key[0]=0}},emulateCycle:{value:function(){this.opcode=this.memory[this.PC]<<8|this.memory[this.PC+1];var a=(3840&this.opcode)>>8,b=(240&this.opcode)>>4;switch(console.log(Utils.toHex(this.opcode)),61440&this.opcode){case 0:switch(61440&this.opcode){case 224:this.clearDisplay();break;case 238:this.PC=this.stack[this.SP--]}break;case 4096:this.PC=4095&this.opcode;break;case 8192:this.SP++,this.stack[this.SP]=this.PC,this.PC=4095&this.opcode;break;case 12288:this.V[3840&this.opcode]==this.opcode&255&&(this.PC+=2);break;case 16384:this.V[a]!=this.opcode&255&&(this.PC+=2);break;case 20480:this.V[a]==this.V[b]&&(this.PC+=2);break;case 24576:this.V[a]=255&this.opcode;break;case 28672:this.V[a]+=255&this.opcode;break;case 32768:switch(15&this.opcode){case 0:this.V[a]=this.V[b];break;case 1:this.V[a]|=this.V[b];break;case 2:this.V[a]&=this.V[b];break;case 3:this.V[a]^=this.V[b];break;case 4:this.V[a]+=this.V[b],this.V[15]=this.V[a]>255?1:0,1==this.V[15]&&(this.V[a]-=255);break;case 5:this.V[15]=this.V[a]>this.V[b]?1:0,this.V[a]-=this.V[b],0==this.V[15]&&(this.V[a]+=255);break;case 6:this.V[15]=1&this.V[a],this.V[a]>>=1;break;case 7:this.V[15]=this.V[b]>this.V[a]?1:0,this.V[a]=this.V[b]-this.V[a],0==this.V[15]&&(this.V[a]+=255);break;case 14:this.V[15]=1&this.V[a],this.V[a]<<=1,this.V[a]>255&&(this.V[a]-=255)}break;case 36864:this.V[a]!=this.V[b]&&(this.CP+=2);break;case 40960:this.I=4095&this.opcode,this.PC+=2;break;case 45056:this.PC=(4095&this.opcode)+this.V[0];break;case 49152:this.V[a]=Math.floor(255*Math.random())&(255&this.opcode);break;case 53248:for(var c=15&this.opcode,d=this.V[a],e=this.V[b],f=0;c>f;f++)for(var g=this.memory[this.I+f],h=0;8>h;h++)if(0!=(g&128>>f)){var i=d+h,j=e+f;j>=64&&(j-=64),0>j&&(j+=64),j>=32&&(j-=32),0>j&&(j+=32),1==this.screen[i+64*j]&&(this.V[15]=1),this.screen[i+64*j]^=1}break;default:console.log("Unknown opcode: "+Utils.toHex(this.opcode))}this.delayTimer>0&&this.delayTimer--,this.soundTimer>0&&(1==this.soundTimer&&console.log("BEEP"),this.soundTimer--),this.PC+=2}},clearDisplay:{value:function(){for(var a=0;a<this.screen.length;a++)this.screen[a]=0}}}),a}(),Utils=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,{toHex:{value:function(a){return"0x"+a.toString(16).toUpperCase()}}}),a}(),_createClass=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},Emulator=function(){function a(){_classCallCheck(this,a),this.load(),this.chip8=new Chip8}return _createClass(a,{load:{value:function(){var a=this,b=new XMLHttpRequest;b.open("GET","roms/pong",!0),b.responseType="arraybuffer",b.onload=function(){var c=new Uint8Array(b.response);a.chip8.loadGame(c),a.loop()},b.send()}},loop:{value:function(){var a=this;this.chip8.emulateCycle(),window.requestAnimationFrame(function(){a.loop()})}}}),a}(),e=new Emulator,_createClass=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},Utils=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,{toHex:{value:function(a){return"0x"+a.toString(16)}}}),a}();